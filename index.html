<!DOCTYPE html>
<html>
<head>
    <link href="./resources/css/index.css" type="text/css" rel="stylesheet">
    <script src="./resources/js/stocks.js"></script>
    <script src="./resources/js/bundle.js"></script>
    <script src="./resources/js/math.js"></script>
</head>
<body>
    <ul class="nav-bar">
        <li><a href="">Home</a></li>
        <li><a href="">Projects</a></li>
        <li><a href="">Contact</a></li>
        <li><a href="">About</a></li>
    </ul>
    <div class="main_text">
        <h1>Hello World</h1>
        <p>Hello my name is Eric! I`m interested in a lot of things.</p>
    </div>
    <script>
        var assets = ['XIC.TO','XIN.TO','XSP.TO','XBB.TO','CAR-UN.TO']
        var options = {
          symbol: 'AAPL',
          interval: 'weekly',
          amount: 52
        };
        var cov = require( 'compute-covariance' );
        let results = {};

        async function getStockData(assets) {
            var stocks = new Stocks('HOW0LDN2HBFLZDA2')
            for (a in assets) {
                options.symbol = assets[a];
                results[a] = await stocks.timeSeries(options);
            }
            return results;
        }
        stockData = getStockData(assets);
        console.log(results);
        
        const retA = (results) => {
            var closeArray = [];
            var returnArray = [];
            for (var p in results) {
                tArray = [];
                rArray = [];
                for (var d in results[p]){
                    console.log(assets[p])
                    tArray.push(results[p][d].close)
                    if (d < 51) {
                        let ld = 0;
                        ld = Number(d) + 1;                   //Latest date placed at start of array.
                        rArray.push((results[p][d].close-results[p][ld].close)/(results[p][ld].close))
                    }
                };
                closeArray[p] = tArray;
                returnArray[p] = rArray;
            }
            return returnArray;
        };
        const closeP = (results) => {
            var closeArray = [];
            for (var p in results) {
                tArray = [];
                for (var d in results[p]){
                    console.log(assets[p])
                    tArray.push(results[p][d].close)    
                }
                closeArray[p] = tArray;
            }
            return closeArray;
        };
        closePrice = closeP(results);
        returns=retA(results);
        covmat=math.matrix(cov(returns));
        weight = [0.2, 0.0, 0.2, 0.40, 0.2];
        tWeight = math.transpose(weight);
        covMarray = math.multiply(covmat,weight);
        risk = math.sqrt(math.multiply(weight,covmat,tWeight))*math.sqrt(51)
        gradient = math.multiply(weight,covmat,51,1/risk)
        ed = 0.05/gradient._data[0]
        hurdle = [];
        for (var g of gradient._data){
            hurdle.push(ed*g)
        } 
        hurdle[0]=0.05

    </script>
        <div class="hurdle-rates-table">
            <table>
                <tr>
                    <td>Asset Class</td>
                    <td>"Conventional" Weight</td>
                    <td>Mean-variance optimal implied expected return</td>
                    <td>Weight in your portfolio</td>
                    <td>Your mean-variance optimal implied expected return</td>
                </tr>
                <tr>
                    <td>S&P 500</td>
                    <td>20%</td>
                    <td><input type="number" id="snp500ret" name="snp500ret" min="0" max="100" step="0.01" value="5"></td>
                    <td>20%</td>
                    <td></td>
                </tr>
                <tr>
                    <td>S&P TSX</td>
                    <td>20%</td>
                    <td></td>
                    <td>20%</td>
                    <td></td>
                </tr>
                <tr>
                    <td>EAFE Equities</td>
                    <td>20%</td>
                    <td></td>
                    <td>20%</td>
                    <td></td>
                </tr>
                <tr>
                    <td>Canadian Bond Universe</td>
                    <td>40%</td>
                    <td></td>
                    <td>40%</td>
                    <td></td>
                </tr>
                <tr>
                    <td>Canadian Apartments Reit</td>
                    <td>0%</td>
                    <td></td>
                    <td>0%</td>
                    <td></td>
                </tr>
            </table>
        </div>
        <div>
            <button onclick="getStockData()">Refresh stock data</button>
        </div>
    </div>
</body>
</html>